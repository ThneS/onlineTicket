# æµ‹è¯•æ–‡æ¡£

æœ¬ç›®å½•åŒ…å« OnlineTicket é¡¹ç›®çš„æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å’Œç›¸å…³æ–‡æ¡£ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
test/
â”œâ”€â”€ README.md                           # æœ¬æ–‡æ¡£
â”œâ”€â”€ PlatformToken.t.sol                # PlatformToken åˆçº¦æµ‹è¯•
â”œâ”€â”€ TicketManager.t.sol                # TicketManager åˆçº¦æµ‹è¯•
â””â”€â”€ TicketManager_TEST_REPORT.md       # TicketManager æµ‹è¯•æŠ¥å‘Š
```

## ğŸ§ª æµ‹è¯•æ¦‚è§ˆ

### PlatformToken æµ‹è¯•

- **æ–‡ä»¶**: `PlatformToken.t.sol`
- **æµ‹è¯•æ•°é‡**: 37 ä¸ªï¼ˆåŒ…å« 2 ä¸ªæ¨¡ç³Šæµ‹è¯•ï¼‰
- **çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡
- **è¦†ç›–èŒƒå›´**: ERC20 ä»£å¸çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½

### TicketManager æµ‹è¯•

- **æ–‡ä»¶**: `TicketManager.t.sol`
- **æµ‹è¯•æ•°é‡**: 45 ä¸ª
- **çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡
- **è¦†ç›–èŒƒå›´**: ERC721 é—¨ç¥¨ NFT çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½

## ğŸš€ è¿è¡Œæµ‹è¯•

### 1. éƒ¨ç½²æµ‹è¯• (2 ä¸ªæµ‹è¯•)

- `test_Deploy()`: éªŒè¯åˆçº¦åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€ç¬¦å·ã€å°æ•°ä½ã€åˆå§‹ä¾›åº”é‡ç­‰ï¼‰
- `test_InitialSupplyMinted()`: éªŒè¯åˆå§‹ä¾›åº”é‡æ­£ç¡®é“¸é€ ç»™æ‰€æœ‰è€…

### 2. Mint åŠŸèƒ½æµ‹è¯• (5 ä¸ªæµ‹è¯•)

- `test_Mint()`: æµ‹è¯•æ­£å¸¸é“¸é€ åŠŸèƒ½
- `test_MintOnlyOwner()`: éªŒè¯åªæœ‰æ‰€æœ‰è€…å¯ä»¥é“¸é€ 
- `test_MintToZeroAddress()`: é˜²æ­¢é“¸é€ åˆ°é›¶åœ°å€
- `test_MintExceedsMaxSupply()`: é˜²æ­¢è¶…è¿‡æœ€å¤§ä¾›åº”é‡
- `test_RemainMintableSupply()`: æµ‹è¯•å‰©ä½™å¯é“¸é€ ä¾›åº”é‡è®¡ç®—

### 3. æ‰¹é‡é“¸é€ æµ‹è¯• (5 ä¸ªæµ‹è¯•)

- `test_BatchMint()`: æµ‹è¯•æ‰¹é‡é“¸é€ åŠŸèƒ½
- `test_BatchMintArrayLengthMismatch()`: éªŒè¯æ•°ç»„é•¿åº¦åŒ¹é…
- `test_BatchMintTooManyRecipients()`: é™åˆ¶æ‰¹é‡é“¸é€ æ•°é‡ï¼ˆæœ€å¤š 200 ä¸ªï¼‰
- `test_BatchMintZeroAddress()`: é˜²æ­¢æ‰¹é‡é“¸é€ åˆ°é›¶åœ°å€
- `test_BatchMintExceedsMaxSupply()`: é˜²æ­¢æ‰¹é‡é“¸é€ è¶…è¿‡æœ€å¤§ä¾›åº”é‡

### 4. é”€æ¯åŠŸèƒ½æµ‹è¯• (6 ä¸ªæµ‹è¯•)

- `test_Burn()`: æµ‹è¯•ä»£å¸é”€æ¯åŠŸèƒ½
- `test_BurnZeroAmount()`: é˜²æ­¢é”€æ¯é›¶æ•°é‡
- `test_BurnInsufficientBalance()`: é˜²æ­¢é”€æ¯è¶…è¿‡ä½™é¢çš„ä»£å¸
- `test_BurnFrom()`: æµ‹è¯•æˆæƒé”€æ¯åŠŸèƒ½
- `test_BurnFromZeroAmount()`: é˜²æ­¢æˆæƒé”€æ¯é›¶æ•°é‡
- `test_BurnFromZeroAddress()`: é˜²æ­¢ä»é›¶åœ°å€é”€æ¯
- `test_BurnFromInsufficientAllowance()`: éªŒè¯æˆæƒé¢åº¦æ£€æŸ¥

### 5. æš‚åœåŠŸèƒ½æµ‹è¯• (6 ä¸ªæµ‹è¯•)

- `test_Pause()`: æµ‹è¯•æš‚åœåŠŸèƒ½
- `test_PauseOnlyOwner()`: éªŒè¯åªæœ‰æ‰€æœ‰è€…å¯ä»¥æš‚åœ
- `test_Unpause()`: æµ‹è¯•å–æ¶ˆæš‚åœåŠŸèƒ½
- `test_UnpauseOnlyOwner()`: éªŒè¯åªæœ‰æ‰€æœ‰è€…å¯ä»¥å–æ¶ˆæš‚åœ
- `test_TransferWhenPaused()`: éªŒè¯æš‚åœæ—¶æ— æ³•è½¬è´¦
- `test_TransferWhenUnpaused()`: éªŒè¯å–æ¶ˆæš‚åœåå¯ä»¥è½¬è´¦

### 6. ç´§æ€¥æå–åŠŸèƒ½æµ‹è¯• (7 ä¸ªæµ‹è¯•)

- `test_EmergencyWithdraw()`: æµ‹è¯•ç´§æ€¥æå–åŠŸèƒ½
- `test_EmergencyWithdrawOnlyOwner()`: éªŒè¯åªæœ‰æ‰€æœ‰è€…å¯ä»¥ç´§æ€¥æå–
- `test_EmergencyWithdrawSelf()`: é˜²æ­¢æå–è‡ªèº«ä»£å¸
- `test_EmergencyWithdrawToZeroAddress()`: é˜²æ­¢æå–åˆ°é›¶åœ°å€
- `test_EmergencyWithdrawInvalidTokenAddress()`: é˜²æ­¢æ— æ•ˆä»£å¸åœ°å€
- `test_EmergencyWithdrawTokenToItself()`: é˜²æ­¢ä»£å¸å‘é€ç»™è‡ªå·±
- `test_EmergencyWithdrawInsufficientBalance()`: éªŒè¯ä½™é¢æ£€æŸ¥

### 7. ERC20 åŸºç¡€åŠŸèƒ½æµ‹è¯• (3 ä¸ªæµ‹è¯•)

- `test_Transfer()`: æµ‹è¯•ä»£å¸è½¬è´¦
- `test_Approve()`: æµ‹è¯•ä»£å¸æˆæƒ
- `test_TransferFrom()`: æµ‹è¯•æˆæƒè½¬è´¦

### 8. æ¨¡ç³Šæµ‹è¯• (2 ä¸ªæµ‹è¯•)

- `testFuzz_Mint()`: éšæœºæ•°é‡é“¸é€ æµ‹è¯•
- `testFuzz_Burn()`: éšæœºæ•°é‡é”€æ¯æµ‹è¯•

## æµ‹è¯•å·¥å…·å’Œè¾…åŠ©åˆçº¦

### MockERC20 åˆçº¦

ä¸ºäº†æµ‹è¯• `emergencyWithdraw` åŠŸèƒ½ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ¨¡æ‹Ÿçš„ ERC20 ä»£å¸åˆçº¦ï¼Œç”¨äºæ¨¡æ‹Ÿå¤–éƒ¨ä»£å¸çš„æå–åœºæ™¯ã€‚

## å®‰å…¨æ£€æŸ¥è¦†ç›–

æµ‹è¯•ç”¨ä¾‹è¦†ç›–äº†ä»¥ä¸‹å®‰å…¨æ£€æŸ¥ï¼š

1. **è®¿é—®æ§åˆ¶**: éªŒè¯åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥æ‰§è¡Œç‰¹å®šæ“ä½œ
2. **è¾“å…¥éªŒè¯**: æ£€æŸ¥é›¶åœ°å€ã€é›¶æ•°é‡ç­‰æ— æ•ˆè¾“å…¥
3. **æ•°é‡é™åˆ¶**: éªŒè¯æœ€å¤§ä¾›åº”é‡ã€æ‰¹é‡æ“ä½œé™åˆ¶ç­‰
4. **çŠ¶æ€æ£€æŸ¥**: éªŒè¯æš‚åœçŠ¶æ€ã€ä½™é¢æ£€æŸ¥ç­‰
5. **é‡å…¥æ”»å‡»é˜²æŠ¤**: é€šè¿‡ ReentrancyGuard ä¿æŠ¤
6. **æˆæƒæ£€æŸ¥**: éªŒè¯ ERC20 æˆæƒæœºåˆ¶

## è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰ PlatformToken æµ‹è¯•
forge test --match-contract PlatformTokenTest

# è¿è¡Œè¯¦ç»†è¾“å‡º
forge test --match-contract PlatformTokenTest -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
forge test --match-test test_Mint

# æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡
forge coverage --match-contract PlatformTokenTest
```

## æ³¨æ„äº‹é¡¹

1. **äº‹ä»¶åç§°**: åˆçº¦ä¸­çš„äº‹ä»¶ `ToknesMinted` æœ‰æ‹¼å†™é”™è¯¯ï¼Œåº”è¯¥ä¿®æ­£ä¸º `TokensMinted`
2. **Gas ä¼˜åŒ–**: æ‰€æœ‰æµ‹è¯•éƒ½æ˜¾ç¤ºäº† gas ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥ç”¨äºä¼˜åŒ–åˆçº¦
3. **æ¨¡ç³Šæµ‹è¯•**: ä½¿ç”¨äº† Foundry çš„æ¨¡ç³Šæµ‹è¯•åŠŸèƒ½ï¼Œæ¯ä¸ªæµ‹è¯•è¿è¡Œ 256 æ¬¡éšæœºè¾“å…¥

## æµ‹è¯•ç»“æœ

âœ… æ‰€æœ‰ 37 ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½é€šè¿‡äº†
âœ… åŒ…å« 2 ä¸ªæ¨¡ç³Šæµ‹è¯•ï¼Œæ¯ä¸ªè¿è¡Œ 256 æ¬¡
âœ… æ€»æµ‹è¯•æ—¶é—´: 81.70ms
âœ… è¦†ç›–äº†åˆçº¦çš„æ‰€æœ‰ä¸»è¦åŠŸèƒ½å’Œå®‰å…¨æ£€æŸ¥
